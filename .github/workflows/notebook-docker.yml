name: notebook-docker
on:
  push:
    branches: [main]

jobs:
  Build:
    runs-on:  notebook
    steps:
      - name: Checkout
        uses: actions/checkout@v3.5.2
      
      - name: Docker Login
        uses: docker/login-action@v2.1.0
        with:
          # Server address of Docker registry. If not set then will default to Docker Hub
          # registry: 
          # Username used to log against the Docker registry
          username: ${{ secrets.DOCKERHUB_USER }}
          # Password or personal access token used to log against the Docker registry
          password: ${{ secrets.DOCKERHUB_PASS }}
      
      - name: Build and push Docker images
        uses: docker/build-push-action@v4.0.0
        with:
           context: .
           push: true
           tags: |
            ncmbjr/teste:v1
            ncmbjr/teste:latest
  Deploy:
    runs-on: notebook
    steps:
      - name: Faz o build novamente da imagem
        uses: docker/build-push-action@v4
        with:
          tags: ncmbjr/teste:latest
          push: false
      - name: Roda o container com a imagem constru√≠da
        uses: addnab/docker-run-action@v3
        with:
          image:  ncmbjr/teste:latest
          run: echo "hello world"
      
        
      
      #- name: Docker Login
        #uses: docker/login-action@v2.1.0
        #with:
          # Server address of Docker registry. If not set then will default to Docker Hub
          #registry: # optional
          # Username used to log against the Docker registry
          #username: ${{ secret.ECR_USER }}
          # Password or personal access token used to log against the Docker registry
          #password: ${{ secret.ECR_USER }}
